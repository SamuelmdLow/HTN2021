{% extends "editLayout.html" %}

{% block tableOfContents%}

    {% for chapter in chapters %}
        <div class="toc">
            - {{chapter[0]}}
        </div>
    {% endfor %}

{% endblock %}

{% block content%}
<form id="info" method="post">
    <input type="hidden" id="chapters" name="chapters" value="">
    <input type="hidden" id="contents" name="contents" value="">
</form>

<div class="addNew">
    back
</div>

<div class="addNew" onclick="update()">
    Update
</div>

<a href="/view/{{id}}" class="addNew" onclick="update()">
    View
</a>

<div id="content">
    <h1>{{name}}</h1>
    
    {% for chapter in content %}
        {% set CH = loop.index %}
        <input type="text " id="C{{CH}}S0" value="{{chapters[loop.index0][0]}}" class="editChapter">
        
        {% for section in chapter %}
            <input type="text " id="C{{CH}}S{{loop.index}}" value="{{section[0]}}" class="editText">
        {% endfor %}
    
    {% endfor %}
</div>

<div class="addNew" onclick="newChapter()">
    New Chapter
</div>

<div class="addNew" onclick="newSection('img')">
    Img+Txt
</div>

<div class="addNew" onclick="newSection('vid')">
    Vid+Txt
</div>


<script>
    
    var chapter = {{chapters|length}};
    var section = {{content|last|length}};
    
    function newChapter()
    {
        section = 0;
        chapter = chapter + 1;
    
        const content = document.getElementById("content");
        var x = document.createElement("INPUT");
        x.setAttribute("type", "text");
        x.setAttribute("class", "editChapter");
        
        id = "C" + chapter.toString() + "S" + section.toString();
        x.setAttribute("id", id);
        content.appendChild(x);
    }
    
    function newSection(type)
    {
        section = section + 1;
        
        const content = document.getElementById("content");
        var x = document.createElement("INPUT");
        x.setAttribute("type", "text");
        x.setAttribute("class", "editText");
        
        id = "C" + chapter.toString() + "S" + section.toString();
        x.setAttribute("id", id);
        content.appendChild(x);
    }
    
    function update()
    {
        var name = "{{name}}";
        var c = [];
        var Cnum = 1;
        var s = "";
        var sc = [];
        var Snum = 0;
        
        var id = "C" + Cnum.toString() + "S" + Snum.toString();
        elem = document.getElementById(id);

        while (elem != null)
        {
            c[c.length] = elem.value;
            Snum = Snum + 1;
            id = "C" + Cnum.toString() + "S" + Snum.toString();
            elem = document.getElementById(id);
            while (elem != null)
            {
                sc[sc.length] = elem.value;
                Snum = Snum + 1;
                id = "C" + Cnum.toString() + "S" + Snum.toString();
                elem = document.getElementById(id);
            }
            s = s + "|" + sc;
            sc = [];
            Cnum = Cnum + 1;
            Snum = 0;
            id = "C" + Cnum.toString() + "S" + Snum.toString();
            elem = document.getElementById(id);
        }
        
        document.getElementById("chapters").value = c;
        alert(c);
        alert(s);
        document.getElementById("contents").value = s;
        document.getElementById("info").submit();
        alert("updated!");
    }
    
</script>

{% endblock %}

